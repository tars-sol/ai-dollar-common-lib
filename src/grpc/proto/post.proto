syntax = "proto3";

package post;

service PostService {
  rpc Create (CreatePostRequest) returns (PostResponse);
  rpc Update (UpdatePostRequest) returns (PostResponse);
  rpc GenerateUploadUrl (GenerateUploadUrlRequest) returns (GenerateUploadUrlResponse);
  rpc GetFeed (GetFeedRequest) returns (GetFeedResponse);
}

message CreatePostRequest {
  string userId = 1;
  string caption = 2;
  string accessType = 3;
  optional int32 priceInCents = 4;
  string s3Key = 5;
  string fileType = 6;
  optional string originalFileName = 7;
}

message UpdatePostRequest {
  string id = 1;
  string userId = 2;
  optional string caption = 3;
  optional string accessType = 4; // "PUBLIC", "SUBSCRIBER", "PAID"
  optional int32 priceInCents = 5;
}

message GenerateUploadUrlRequest {
  string userId = 1;
  string fileName = 2;
  string contentType = 3;
}

message GenerateUploadUrlResponse {
  string uploadUrl = 1;
  string key = 2;
}

message GetFeedRequest {
  string userId = 1;
}

message GetFeedResponse {
  repeated PostResponse posts = 1;
}

message PostResponse {
  string id = 1;
  string userId = 2;
  string caption = 3;
  string accessType = 4; // "PUBLIC", "SUBSCRIBER", "PAID"
  optional int32 priceInCents = 5;
  string s3Key = 6;
  string fileType = 7; // "IMAGE", "VIDEO", "CODE", "OTHER"
  string originalFileName = 8;

  string createdAt = 9;
  string updatedAt = 10;

  string signedUrl = 11;
}
